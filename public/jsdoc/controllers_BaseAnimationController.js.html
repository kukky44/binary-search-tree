<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>controllers/BaseAnimationController.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AnimationController.html">AnimationController</a><ul class='methods'><li data-type='method'><a href="AnimationController.html#assignNewNodepos">assignNewNodepos</a></li><li data-type='method'><a href="AnimationController.html#deepCopyTree">deepCopyTree</a></li><li data-type='method'><a href="AnimationController.html#finishAnimation">finishAnimation</a></li><li data-type='method'><a href="AnimationController.html#getHighlightedCode">getHighlightedCode</a></li><li data-type='method'><a href="AnimationController.html#getState">getState</a></li><li data-type='method'><a href="AnimationController.html#handleInsertOperation">handleInsertOperation</a></li><li data-type='method'><a href="AnimationController.html#handleRegularStep">handleRegularStep</a></li><li data-type='method'><a href="AnimationController.html#handleRemoveOperation">handleRemoveOperation</a></li><li data-type='method'><a href="AnimationController.html#handleStep27">handleStep27</a></li><li data-type='method'><a href="AnimationController.html#handleSteps15And16">handleSteps15And16</a></li><li data-type='method'><a href="AnimationController.html#nextStep">nextStep</a></li><li data-type='method'><a href="AnimationController.html#popStack">popStack</a></li><li data-type='method'><a href="AnimationController.html#prevStep">prevStep</a></li><li data-type='method'><a href="AnimationController.html#resetAnimation">resetAnimation</a></li><li data-type='method'><a href="AnimationController.html#skipAnimation">skipAnimation</a></li><li data-type='method'><a href="AnimationController.html#startInsertAnimation">startInsertAnimation</a></li><li data-type='method'><a href="AnimationController.html#startRemoveAnimation">startRemoveAnimation</a></li><li data-type='method'><a href="AnimationController.html#switchStack">switchStack</a></li><li data-type='method'><a href="AnimationController.html#updateCodeSnippet">updateCodeSnippet</a></li></ul></li><li><a href="AvlAnimationController.html">AvlAnimationController</a><ul class='methods'><li data-type='method'><a href="AvlAnimationController.html#assignNewNodepos">assignNewNodepos</a></li><li data-type='method'><a href="AvlAnimationController.html#deepCopyTree">deepCopyTree</a></li><li data-type='method'><a href="AvlAnimationController.html#finishAnimation">finishAnimation</a></li><li data-type='method'><a href="AvlAnimationController.html#finishBalanceAnimation">finishBalanceAnimation</a></li><li data-type='method'><a href="AvlAnimationController.html#getHighlightedCode">getHighlightedCode</a></li><li data-type='method'><a href="AvlAnimationController.html#getState">getState</a></li><li data-type='method'><a href="AvlAnimationController.html#nextStep">nextStep</a></li><li data-type='method'><a href="AvlAnimationController.html#operateBalanceTree">operateBalanceTree</a></li><li data-type='method'><a href="AvlAnimationController.html#popStack">popStack</a></li><li data-type='method'><a href="AvlAnimationController.html#prevStep">prevStep</a></li><li data-type='method'><a href="AvlAnimationController.html#resetAnimation">resetAnimation</a></li><li data-type='method'><a href="AvlAnimationController.html#skipAnimation">skipAnimation</a></li><li data-type='method'><a href="AvlAnimationController.html#startBalanceAnimation">startBalanceAnimation</a></li><li data-type='method'><a href="AvlAnimationController.html#startBalanceRmAnimation">startBalanceRmAnimation</a></li><li data-type='method'><a href="AvlAnimationController.html#startInsertAnimation">startInsertAnimation</a></li><li data-type='method'><a href="AvlAnimationController.html#startRemoveAnimation">startRemoveAnimation</a></li><li data-type='method'><a href="AvlAnimationController.html#switchStack">switchStack</a></li><li data-type='method'><a href="AvlAnimationController.html#updateCodeSnippet">updateCodeSnippet</a></li></ul></li><li><a href="AvlIntBSTForAnimation.html">AvlIntBSTForAnimation</a><ul class='methods'><li data-type='method'><a href="AvlIntBSTForAnimation.html#insert">insert</a></li><li data-type='method'><a href="AvlIntBSTForAnimation.html#insertIntoSubtree">insertIntoSubtree</a></li></ul></li><li><a href="BaseAnimationController.html">BaseAnimationController</a><ul class='methods'><li data-type='method'><a href="BaseAnimationController.html#assignNewNodepos">assignNewNodepos</a></li><li data-type='method'><a href="BaseAnimationController.html#deepCopyTree">deepCopyTree</a></li><li data-type='method'><a href="BaseAnimationController.html#finishAnimation">finishAnimation</a></li><li data-type='method'><a href="BaseAnimationController.html#getState">getState</a></li><li data-type='method'><a href="BaseAnimationController.html#nextStep">nextStep</a></li><li data-type='method'><a href="BaseAnimationController.html#popStack">popStack</a></li><li data-type='method'><a href="BaseAnimationController.html#prevStep">prevStep</a></li><li data-type='method'><a href="BaseAnimationController.html#resetAnimation">resetAnimation</a></li><li data-type='method'><a href="BaseAnimationController.html#startInsertAnimation">startInsertAnimation</a></li><li data-type='method'><a href="BaseAnimationController.html#startRemoveAnimation">startRemoveAnimation</a></li><li data-type='method'><a href="BaseAnimationController.html#switchStack">switchStack</a></li><li data-type='method'><a href="BaseAnimationController.html#updateCodeSnippet">updateCodeSnippet</a></li></ul></li><li><a href="CodeDisplayManager.html">CodeDisplayManager</a><ul class='methods'><li data-type='method'><a href="CodeDisplayManager.html#addLayer">addLayer</a></li><li data-type='method'><a href="CodeDisplayManager.html#clearCode">clearCode</a></li><li data-type='method'><a href="CodeDisplayManager.html#removeLayer">removeLayer</a></li><li data-type='method'><a href="CodeDisplayManager.html#setCode">setCode</a></li></ul></li><li><a href="IntBST.html">IntBST</a><ul class='methods'><li data-type='method'><a href="IntBST.html#balanceTreeAfterRemoval">balanceTreeAfterRemoval</a></li><li data-type='method'><a href="IntBST.html#getBalanceFactor">getBalanceFactor</a></li><li data-type='method'><a href="IntBST.html#getHeightOfSubtree">getHeightOfSubtree</a></li><li data-type='method'><a href="IntBST.html#insert">insert</a></li><li data-type='method'><a href="IntBST.html#insert">insert</a></li><li data-type='method'><a href="IntBST.html#insertIntoSubtree">insertIntoSubtree</a></li><li data-type='method'><a href="IntBST.html#insertIntoSubtree">insertIntoSubtree</a></li><li data-type='method'><a href="IntBST.html#remove">remove</a></li><li data-type='method'><a href="IntBST.html#remove">remove</a></li><li data-type='method'><a href="IntBST.html#removeR">removeR</a></li><li data-type='method'><a href="IntBST.html#removeR">removeR</a></li><li data-type='method'><a href="IntBST.html#rotateLeft">rotateLeft</a></li><li data-type='method'><a href="IntBST.html#rotateLeftRight">rotateLeftRight</a></li><li data-type='method'><a href="IntBST.html#rotateRight">rotateRight</a></li><li data-type='method'><a href="IntBST.html#rotateRightLeft">rotateRightLeft</a></li></ul></li><li></li><li><a href="IntBSTRenderer.html">IntBSTRenderer</a><ul class='methods'><li data-type='method'><a href="IntBSTRenderer.html#animateNodePosition">animateNodePosition</a></li><li data-type='method'><a href="IntBSTRenderer.html#drawBalanceFactor">drawBalanceFactor</a></li><li data-type='method'><a href="IntBSTRenderer.html#drawConnection">drawConnection</a></li><li data-type='method'><a href="IntBSTRenderer.html#drawEmptyTree">drawEmptyTree</a></li><li data-type='method'><a href="IntBSTRenderer.html#drawIntBST">drawIntBST</a></li><li data-type='method'><a href="IntBSTRenderer.html#drawNewAddingNode">drawNewAddingNode</a></li><li data-type='method'><a href="IntBSTRenderer.html#drawNodes">drawNodes</a></li><li data-type='method'><a href="IntBSTRenderer.html#drawTempBack">drawTempBack</a></li><li data-type='method'><a href="IntBSTRenderer.html#drawTempTree">drawTempTree</a></li><li data-type='method'><a href="IntBSTRenderer.html#drawTreeNode">drawTreeNode</a></li><li data-type='method'><a href="IntBSTRenderer.html#getNodeColors">getNodeColors</a></li><li data-type='method'><a href="IntBSTRenderer.html#getTempBackSize">getTempBackSize</a></li><li data-type='method'><a href="IntBSTRenderer.html#render">render</a></li><li data-type='method'><a href="IntBSTRenderer.html#resizeWidths">resizeWidths</a></li><li data-type='method'><a href="IntBSTRenderer.html#setNewPositionsWithAnimation">setNewPositionsWithAnimation</a></li><li data-type='method'><a href="IntBSTRenderer.html#setup">setup</a></li></ul></li><li><a href="Node.html">Node</a></li><li><a href="RecursionStackController.html">RecursionStackController</a><ul class='methods'><li data-type='method'><a href="RecursionStackController.html#clear">clear</a></li><li data-type='method'><a href="RecursionStackController.html#insert">insert</a></li><li data-type='method'><a href="RecursionStackController.html#pop">pop</a></li><li data-type='method'><a href="RecursionStackController.html#switch">switch</a></li></ul></li><li><a href="UIController.html">UIController</a><ul class='methods'><li data-type='method'><a href="UIController.html#clearInputs">clearInputs</a></li><li data-type='method'><a href="UIController.html#disableOperationsBtns">disableOperationsBtns</a></li><li data-type='method'><a href="UIController.html#disablePrevBtn">disablePrevBtn</a></li><li data-type='method'><a href="UIController.html#disableSKipBtn">disableSKipBtn</a></li><li data-type='method'><a href="UIController.html#disableStepBtns">disableStepBtns</a></li><li data-type='method'><a href="UIController.html#displayVisDesc">displayVisDesc</a></li><li data-type='method'><a href="UIController.html#enableNextBtn">enableNextBtn</a></li><li data-type='method'><a href="UIController.html#enableOperationBtns">enableOperationBtns</a></li><li data-type='method'><a href="UIController.html#enableSkipBtn">enableSkipBtn</a></li><li data-type='method'><a href="UIController.html#enableStepBtns">enableStepBtns</a></li><li data-type='method'><a href="UIController.html#hideStepDesc">hideStepDesc</a></li><li data-type='method'><a href="UIController.html#hideVisDesc">hideVisDesc</a></li><li data-type='method'><a href="UIController.html#setStepDesc">setStepDesc</a></li><li data-type='method'><a href="UIController.html#showStepDesc">showStepDesc</a></li></ul></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">controllers/BaseAnimationController.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Base animation controller class containing shared functionality for BST and AVL animations
 */
class BaseAnimationController {
  /**
   * Creates a new base animation controller
   * @constructor
   * @param {IntBST} intBST - The binary search tree to animate
   * @param {CodeDisplayManager} codeDisplayManager - Manager for code snippets
   * @param {UIController} uiController - Controller for UI updates
   * @param {RecursionStackController} rsController - Controller for recursion stack
   */
  constructor(intBST, codeDisplayManager, uiController, rsController) {
    this.intBST = intBST;
    this.codeDisplayManager = codeDisplayManager;
    this.uiController = uiController;
    this.rsController = rsController;

    this.state = {
      operation: null,
      value: null,
      step: 1,
      maxSteps: 0,
      animating: false,
      animationSpeed: ANIMATION.SPEED,
      mode: 'step',
    };

    this.animationCount = 0;
    this.stepCount = 0;
    this.initialTree = null;
    this.initialOperation = null;
    this.currNode = null;
    this.currSuccessor = null;
    this.currSParent = null;
    this.currentRsStack = 0;
    this.subHighlighted = [];
    this.recursionStack = [];
    this.isRemoving = false;
    this.displayNew = false;
    this.flags = {
      pause: false,
      isPrev: false,
      isTemp: false,
    };
  }

  /**
   * Starts an insert animation
   * @param {int} value - The value to add
   */
  startInsertAnimation(value) {
    this.resetAnimation();
    this.state.operation = 'insert';
    this.initialOperation = 'insert';
    this.state.value = Number.parseInt(value);
    this.state.maxSteps = ANIMATION.STEPS.INSERT;

    this.displayNew = true;

    this.codeDisplayManager.addLayer(this.flags);
    this.codeDisplayManager.setCode(OPERATIONS_SNIPPET.insertCallR);
    this.uiController.setStepDesc(STEP_DESCRIPTIONS.insert[0]);

    if (this.state.mode === 'animate') {
      this.state.animating = true;
      this.uiController.disableStepBtns();
    }
  }

  /**
   * Starts a remove animation
   * @param {int} value - The value to remove
   */
  startRemoveAnimation(value) {
    this.resetAnimation();
    this.state.operation = 'remove';
    this.initialOperation = 'remove';
    this.state.value = value;
    this.state.maxSteps = ANIMATION.STEPS.REMOVE;
    this.uiController.displayVisDesc();

    this.codeDisplayManager.addLayer(this.flags);
    this.codeDisplayManager.setCode(OPERATIONS_SNIPPET.removeCallR);
    this.uiController.setStepDesc(STEP_DESCRIPTIONS.remove[0]);

    this.currSuccessor = null;
    this.currSParent = null;

    if (this.state.mode === 'animate') {
      this.state.animating = true;
      this.uiController.disableStepBtns();
    }
  }

  /**
   * Resets animation state to initial values, updates UI
   */
  resetAnimation() {
    this.currNode = this.intBST.root;
    this.initialTree = this.deepCopyTree(this.intBST.root);

    this.state.step = 0;
    this.animationCount = 0;
    this.state.animating = false;
    this.stepCount = 0;

    this.uiController.showStepDesc();
    this.uiController.enableNextBtn();
    this.uiController.disableOperationsBtns();
    this.uiController.enableSkipBtn();
  }

  /**
   * Pops the recursion stack, updates the current node, and removes the current code layer
   */
  popStack() {
    this.recursionStack.pop();
    this.currNode = this.recursionStack[this.recursionStack.length-1]?.node;
    this.rsController.pop();
    this.codeDisplayManager.removeLayer(this.flags);
  }

  /**
   * Switches the recursion stack (for the recursion stack tab)
   * @method
   * @param {number} index - The index of the recursion stack to switch to
   */
  switchStack = (index) => {
    this.currentRsStack = index;
    this.rsController.switch(this.currentRsStack);
  }

  /**
   * Moves to the previous animation step.
   * The initial structure of the tree is stored when the operation starts, and after
   * this method is called, the tree is reset to the initial structure it calls nextStep()
   * untill it reaches the previous step.
   * @method
   */
  prevStep = () => {
    if (!this.state.operation) return;
    this.flags.isPrev = true;
    let count = this.stepCount;
    this.codeDisplayManager.clearCode();

    if (this.state.step &lt;= 1) {
      this.uiController.hideStepDesc();
    } else {
      this.uiController.showStepDesc();
    }

    this.finishAnimation();
    this.intBST.root = this.initialTree;
    if(this.initialOperation === 'insert') {
      this.startInsertAnimation(this.state.value);      
    } else {
      this.startRemoveAnimation(this.state.value);
    }
    
    count--;
    for(let i = 0; i &lt; count; i++) {
      this.nextStep();
    }
    this.flags.isPrev = false;
  
  }

  /**
   * Moves to the next animation step.
   * It will be inherited by the animation controllers for the normal BST and AVL Tree.
   * @return {boolean} True if it can move to the next step, false otherwise
   */
  nextStep() {
    if(!this.state.operation) return false;

    if(!this.flags.isPrev &amp;&amp; this.flags.pause) return false;
    this.stepCount++;
    
    console.log('ani state:', this.state.step);

    if (this.state.step === this.state.maxSteps) {
      this.finishAnimation();
      if (this.state.mode === 'animate') {
        this.state.animating = false;
      }
      return true;
    } 
    return true;
  }

  /**
   * Updates code snippet based on current state
   */
  updateCodeSnippet() {
    let description = STEP_DESCRIPTIONS[this.state.operation][this.state.step];
    this.uiController.setStepDesc(description);
    this.codeDisplayManager.setCode(this.getHighlightedCode(this.state.operation, this.state.step));
  }

  /**
   * Assigns the new node position for the temp tree based on the previous node
   */
  assignNewNodepos() {
    let x = CANVAS.WIDTH / 2, y = NODE.DEFAULT_Y;
    const prevNode = this.recursionStack[this.recursionStack.length-2]?.node;

    if(!prevNode) {
      this.tempIntBst.root.x = x;
      this.tempIntBst.root.y = y;
      return;
    }

    if(prevNode.value > this.tempIntBst.root.value) {
      x = prevNode.x - 40;
    } else {
      x = prevNode.x + 40;
    }
    this.tempIntBst.root.x = x;
    this.tempIntBst.root.y = prevNode.y + 40;
  }

  /**
   * Finishes the current animation, resets the animation state, clear views, and updates the UI
   */
  finishAnimation() {
    this.recursionStack = [];
    this.uiController.hideStepDesc();
    this.uiController.disableStepBtns();
    this.uiController.enableOperationBtns();
    this.uiController.disableSKipBtn();
    this.uiController.clearInputs();
    this.uiController.hideVisDesc();
    this.rsController.clear();
    this.codeDisplayManager.clearCode();
    this.subHighlighted = [];
    this.state.operation = null;
  }

  /**
   * Gets the current animation state
   * @return {Object} The current animation state
   */
  getState() {
    return this.state;
  }

  /**
   * Deep copies a BST
   * @param {Node} node - The root node of the tree to copy
   * @return {Node} The copied root node of the tree
   */
  deepCopyTree(node) {
    if (!node) return null;
    const newNode = new Node(node.value);
    newNode.x = node.x;
    newNode.y = node.y;
    newNode.left = this.deepCopyTree(node.left);
    newNode.right = this.deepCopyTree(node.right);
    return newNode;
  }
} </code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.4</a> on Wed Jun 04 2025 02:01:21 GMT+1200 (New Zealand Standard Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
